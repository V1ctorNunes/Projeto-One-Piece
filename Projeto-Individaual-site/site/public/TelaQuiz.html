<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="./css/style-quiz.css">
  <title>Quiz</title>
</head>
<body>
  <div id="background">
    <video loop muted autoplay>
      <source src="./assets/abertura-onepiece-atualizado.mp4">
    </video>
  </div>

  <div id="app">
    <header>
      <ul class="navigation">
        <li>
          <a href="./index.html" class="navigation__link">Home</a>
        </li>
        <li>
          <a href="TelaPersonagens.html" class="navigation__link">Personagens</a>
        </li>
        <li>
          <a href="" class="navigation__link">Contato</a>
        </li>
        <li>
          <a href="" class="navigation__link">Sobre o Projeto</a>
        </li>
      </ul>

      <div class="navigation_login_and_cadastro">  
        <img src="./assets/onepiece.png" alt="">
      </div>
    </header>
  
    <main class="conatiner-principal">
      <div class="container-div">
        <div class="orientacao-quiz" id="menasgem">
          <p>
            COMO JOGA O QUIZ?
          </p>
          <span>
            Lorem ipsum dolor sit amet consectetur adipisicing elit. Quam aperiam, error ipsam deleniti minima est alias amet sit aliquam laudantium sapiente delectus eius? Reprehenderit quia vel eos, beatae officiis et.
          </span>
        </div>
        <div class="text-question hide" id="questions_container">
          <p id="number_questions"></p>
          <p class="questions">Questão</p>
          <div class="answars-container" id="answarsContainer">
            <button class="answars button"> resposta 1 </button>
            <button class="answars button"> resposta 2 </button>
            <button class="answars button"> resposta 3 </button>
            <button class="answars button"> resposta 4 </button>
          </div>
        </div>
        <div class="controls-container">
          <button id="startGame" class="start-quiz button" onclick="start_game(1)">Começar Quiz</button>
          <button class="next-question button hide" id="next" onclick="nextQuestions()">Próxima Pergunta</button>
        </div>
      </div>
    </main>

    <footer> 
      <div class="footer__info">
        <p>
          Lorem ipsum, dolor sit amet consectetur adipisicing elit. Voluptates blanditiis tempore commodi soluta dolores doloribus perspiciatis minima consequatur accusantium dolorum facere architecto nisi aliquid natus nam, quibusdam atque, hic fugiat!
        </p>
      </div>
  
      <div class="footer__social">
        <a class="icon-wpp"><i class="bi bi-whatsapp"></i></a>
        <a class="icon-instagram"><i class="bi bi-instagram"></i></a>
        <a class="icon-gitHub"><i class="bi bi-github"></i></a>
        <a class="icon-linkedin"><i class="bi bi-linkedin"></i></a>
      </div>
  
      <div class="email">
        <p>Mande um E-mail <br>
          <div class="icon-email">
            <input type="email"> <a> <i class="bi bi-envelope"></i></a>
          </div>  
        </p>
      </div>
    </footer>
  </div>
  
</body>
</html>

<script> 
  // dados que irao para o banco
  var currentQuestionsIndex = 0
  var totalCorrect = 0
  var armazenarValor = 0
  var tentativaArmazenar = 0

  var number = document.getElementById("number_questions")
  var answarsContainer = document.getElementById('answarsContainer')
  var question_start = document.querySelector('.questions')
  var next = document.getElementById('next')
  
  function ranking() {
     // fetch envia para rotas
  fetch("/usuarios/quiz", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    // body ele leva os dados para usuario.js
    body: JSON.stringify({
      // crie um atributo que recebe o valor recuperado aqui
      // Agora vá para o arquivo routes/usuario.js
      acertos: totalCorrect,
      score: armazenarValor,
      tentativas: tentativaArmazenar,
    }),
  })

  .then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));
                    sessionStorage.FK_USUARIO = json.email;
                    sessionStorage.NOME_USUARIO = json.nome;
                    sessionStorage.ID_USUARIO = json.idUsuario;
                    // sessionStorage.AQUARIOS = JSON.stringify(json.aquarios)

                    setTimeout(function () {
                        window.location = "teste.html";
                    }, 1000); // apenas para exibir o loading

                });

            } else {

                console.log("Houve um erro ao tentar ao mandar pro banco");

            }

        }).catch(function (erro) {
            console.log(erro);
        })

  return false;
  }
  
  function start_game(tentativa){
    // INICIAL

    tentativaArmazenar += 1
    var gameButton = document.getElementById('startGame')
    var orientacao = document.getElementById('menasgem')
    
    gameButton.classList.add('hide')
    orientacao.classList.add('hide')

    // COMECANDO QUIZ
    var questions = document.getElementById('questions_container')
    
    questions.classList.remove('hide')
    
    nextQuestions()
  }

  function nextQuestions() {
      resetSate()
    
      if (questions.length === currentQuestionsIndex) {
        return finishGame()
      } else {
  
      number.textContent = questions[currentQuestionsIndex].number

      question_start.textContent = questions[currentQuestionsIndex].question

      questions[currentQuestionsIndex].answars.forEach(answer => {
      
      var newAnswer = document.createElement("button")
      newAnswer.classList.add("button", "answars")
      newAnswer.textContent = answer.text
     
      if(answer.correct) {
        newAnswer.dataset.correct = answer.correct
      }
      answarsContainer.appendChild(newAnswer)

      newAnswer.addEventListener("click", selectAnswer)
    })
      }  

  }

  function resetSate() {
    while(answarsContainer.firstChild) {
      answarsContainer.removeChild(answarsContainer.firstChild)
    }
  }
  
  function selectAnswer(event) {
    var answarClicked = event.target
    
    if (answarClicked.dataset.correct) {
      totalCorrect++
      armazenarValor += 5 
    } 

    document.querySelectorAll('.answars').forEach(button => {

      if(button.dataset.correct) {
        button.classList.add("answarCorrect")
        
        
      } else {
        button.classList.add("answarIncorret")
      }

      button.disabled = true
     
    
      
    })

  next.classList.remove('hide')
  currentQuestionsIndex++
}

  function finishGame() {
    var totalQuestion = questions.length
    var performance = Math.floor(totalCorrect * 100 / totalQuestion)

    next.classList.add('hide')
    questions_container.innerHTML = 
    `
    <div class="container-finish" id="container-final">
      <img src="./assets/bando-luffy-PhotoRoom.png-PhotoRoom.png" width="300px">

      <div class="final-mensagem">
        <p class="resultado"> 
          resultado
        </p>
        <p class="mensagem-final"> 
          Voce acertou ${totalCorrect} de ${totalQuestion} <br>
          <span>Resultado: ${armazenarValor}</span>
          <span>Tentativas: ${tentativaArmazenar}</span>
        </p>
        <a class="button-final" onclick="ranking()">
        Refazer Quiz
        </a>
      </div>
    </div>
 
    `
  }

 const questions = [{
  number: "Questão Numero 1",
  question: "Qual é o personagem principal de One Piece?",
  answars: [
    { text: "Monkey D. Luffy", correct: true},
    { text: "Roronoa Zoro", correct: false},
    { text: "Sanji", correct: false},
    { text: "Nami", correct:false}
  ]
},
  {
    number: "Questão Numero 2",
    question: "Quantas raças existem no mundo de One Piece",
    answars: [
    { text: "12", correct: false},
    { text: "14", correct: false},
    { text: "15", correct: true},
    { text: "16", correct:false}
  ]
}, 
{
    number: "Questão Numero 3",
    question: "Quem é o irmão de Monkey D. Luffy?",
    answars: [
    { text: "Sabo", correct: false},
    { text: "Portas D. Ace", correct: true},
    { text: "Roronoa Zoro", correct: false},
    { text: "Sanji", correct:false}
  ]
}
]

</script>